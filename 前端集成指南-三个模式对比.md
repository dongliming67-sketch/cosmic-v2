# 前端集成指南 - 三个模式对比

## 概述

现在系统支持三种COSMIC拆分模式，您可以在前端界面中选择使用：

1. **数量优先模式**（现有）- 使用智谱/OpenAI API
2. **质量优先模式**（现有）- 使用智谱/OpenAI API
3. **三层分析框架模式**（新增）- 使用Groq API

## 配置步骤

### 1. 配置Groq API密钥

在 `.env` 文件中添加：

```env
# Groq API配置（用于三层分析框架模式）
GROQ_API_KEY=your_groq_api_key_here
GROQ_MODEL=llama-3.3-70b-versatile
```

**获取Groq API密钥**：
1. 访问 https://console.groq.com
2. 注册/登录账号
3. 在API Keys页面创建新密钥
4. 复制密钥到 `.env` 文件

### 2. 前端代码修改

在 `client/src/App.jsx` 中，找到分析模式选择部分，添加第三个选项：

```jsx
// 在现有的分析模式状态中添加第三个选项
const [analysisMode, setAnalysisMode] = useState('quantity'); // 'quantity' | 'quality' | 'three-layer'

// 在界面中添加第三个单选按钮
<div className="mode-selector">
  <label>
    <input 
      type="radio" 
      value="quantity" 
      checked={analysisMode === 'quantity'}
      onChange={(e) => setAnalysisMode(e.target.value)}
    />
    数量优先
  </label>
  
  <label>
    <input 
      type="radio" 
      value="quality" 
      checked={analysisMode === 'quality'}
      onChange={(e) => setAnalysisMode(e.target.value)}
    />
    质量优先
  </label>
  
  <label>
    <input 
      type="radio" 
      value="three-layer" 
      checked={analysisMode === 'three-layer'}
      onChange={(e) => setAnalysisMode(e.target.value)}
    />
    三层分析框架 (Groq)
  </label>
</div>
```

### 3. 修改API调用逻辑

在执行分析的函数中，根据选择的模式调用不同的API：

```jsx
const executeAnalysis = async () => {
  let apiEndpoint = '';
  
  switch (analysisMode) {
    case 'quantity':
      apiEndpoint = '/api/continue-analyze';
      break;
    case 'quality':
      apiEndpoint = '/api/quality-continue-analyze';
      break;
    case 'three-layer':
      apiEndpoint = '/api/three-layer-analyze';
      break;
    default:
      apiEndpoint = '/api/continue-analyze';
  }
  
  // 执行循环分析
  let round = 1;
  let isDone = false;
  let allResults = [];
  
  while (!isDone && round <= 10) {
    const response = await fetch(apiEndpoint, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        documentContent: documentText,
        previousResults: allResults,
        round: round,
        targetFunctions: targetFunctionCount,
        understanding: documentUnderstanding,
        userGuidelines: userGuidelines
      })
    });
    
    const data = await response.json();
    
    if (data.success) {
      // 解析并添加到结果中
      const newRows = parseMarkdownTable(data.reply);
      allResults = [...allResults, ...newRows];
      
      isDone = data.isDone;
      round++;
      
      // 更新进度显示
      updateProgress(data.completedFunctions, data.targetFunctions, analysisMode);
    } else {
      console.error('分析失败:', data.error);
      break;
    }
  }
  
  // 显示最终结果
  setTableData(allResults);
};
```

### 4. 添加模式说明

在界面上为每个模式添加说明文字：

```jsx
<div className="mode-descriptions">
  <div className={`mode-desc ${analysisMode === 'quantity' ? 'active' : ''}`}>
    <h4>数量优先模式</h4>
    <p>快速拆分，注重覆盖所有功能点</p>
    <ul>
      <li>✓ 速度快</li>
      <li>✓ 功能覆盖全</li>
      <li>⚠ 可能有属性重复</li>
    </ul>
  </div>
  
  <div className={`mode-desc ${analysisMode === 'quality' ? 'active' : ''}`}>
    <h4>质量优先模式</h4>
    <p>深度理解文档，确保每个功能过程的质量</p>
    <ul>
      <li>✓ 质量高</li>
      <li>✓ 描述详细</li>
      <li>⚠ 耗时较长</li>
    </ul>
  </div>
  
  <div className={`mode-desc ${analysisMode === 'three-layer' ? 'active' : ''}`}>
    <h4>三层分析框架模式 (Groq)</h4>
    <p>使用三层分析框架，确保FP边界清晰、属性唯一</p>
    <ul>
      <li>✓ FP边界清晰</li>
      <li>✓ 属性唯一性高</li>
      <li>✓ ERWX完整闭环</li>
      <li>✓ 速度快（Groq）</li>
    </ul>
  </div>
</div>
```

### 5. 添加样式

在CSS文件中添加样式：

```css
.mode-selector {
  display: flex;
  gap: 20px;
  margin: 20px 0;
  padding: 15px;
  background: #f5f5f5;
  border-radius: 8px;
}

.mode-selector label {
  display: flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
  padding: 10px 15px;
  border-radius: 6px;
  transition: background 0.3s;
}

.mode-selector label:hover {
  background: #e0e0e0;
}

.mode-selector input[type="radio"] {
  cursor: pointer;
}

.mode-descriptions {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 15px;
  margin: 20px 0;
}

.mode-desc {
  padding: 15px;
  border: 2px solid #e0e0e0;
  border-radius: 8px;
  background: #fafafa;
  transition: all 0.3s;
}

.mode-desc.active {
  border-color: #4CAF50;
  background: #f1f8f4;
  box-shadow: 0 2px 8px rgba(76, 175, 80, 0.2);
}

.mode-desc h4 {
  margin: 0 0 10px 0;
  color: #333;
}

.mode-desc p {
  margin: 0 0 10px 0;
  color: #666;
  font-size: 14px;
}

.mode-desc ul {
  margin: 0;
  padding-left: 20px;
  font-size: 13px;
  color: #555;
}

.mode-desc ul li {
  margin: 5px 0;
}
```

## 三个模式的对比

| 特性 | 数量优先 | 质量优先 | 三层分析框架 |
|------|---------|---------|-------------|
| **API提供商** | 智谱/OpenAI | 智谱/OpenAI | Groq |
| **速度** | 快 | 中等 | 非常快 |
| **FP边界清晰度** | 中等 | 高 | 非常高 |
| **属性唯一性** | 低-中 | 中-高 | 非常高 |
| **ERWX完整性** | 中等 | 高 | 100% |
| **拆分完整度** | 高 | 高 | 非常高 |
| **成本** | 低 | 中 | 低（Groq免费额度大） |
| **适用场景** | 快速评估 | 正式项目 | 高质量要求项目 |

## 使用建议

### 场景1：快速评估
**推荐模式**：数量优先
- 快速了解项目规模
- 初步评估功能点数量
- 时间紧迫的情况

### 场景2：正式项目交付
**推荐模式**：质量优先
- 需要详细的功能描述
- 对质量有一定要求
- 使用智谱/OpenAI API

### 场景3：高质量要求项目
**推荐模式**：三层分析框架
- 需要最高质量的拆分结果
- 要求FP边界清晰、属性唯一
- 希望使用免费/低成本的Groq API
- 需要完整的ERWX闭环

### 场景4：对比验证
**推荐做法**：三个模式都运行一遍
- 对比不同模式的拆分结果
- 选择最符合需求的结果
- 或综合多个结果

## 进度显示优化

为了让用户能够直观看到三个模式的对比，建议在进度显示中增加模式标识：

```jsx
const updateProgress = (completed, target, mode) => {
  const modeNames = {
    'quantity': '数量优先',
    'quality': '质量优先',
    'three-layer': '三层分析框架'
  };
  
  const progress = Math.round((completed / target) * 100);
  
  setProgressText(`【${modeNames[mode]}】已完成 ${completed}/${target} 个功能过程 (${progress}%)`);
};
```

## 结果对比功能（可选）

如果您想实现三个模式的结果对比功能，可以添加：

```jsx
const [comparisonMode, setComparisonMode] = useState(false);
const [comparisonResults, setComparisonResults] = useState({
  quantity: [],
  quality: [],
  threeLayer: []
});

// 执行三个模式的对比分析
const executeComparison = async () => {
  setComparisonMode(true);
  
  // 依次执行三个模式
  const modes = ['quantity', 'quality', 'three-layer'];
  
  for (const mode of modes) {
    const results = await executeAnalysisForMode(mode);
    setComparisonResults(prev => ({
      ...prev,
      [mode === 'three-layer' ? 'threeLayer' : mode]: results
    }));
  }
  
  // 显示对比结果
  showComparisonView();
};

// 显示对比视图
const showComparisonView = () => {
  return (
    <div className="comparison-view">
      <div className="comparison-column">
        <h3>数量优先 ({comparisonResults.quantity.length}个FP)</h3>
        <table>{/* 显示数量优先结果 */}</table>
      </div>
      
      <div className="comparison-column">
        <h3>质量优先 ({comparisonResults.quality.length}个FP)</h3>
        <table>{/* 显示质量优先结果 */}</table>
      </div>
      
      <div className="comparison-column">
        <h3>三层分析框架 ({comparisonResults.threeLayer.length}个FP)</h3>
        <table>{/* 显示三层分析框架结果 */}</table>
      </div>
    </div>
  );
};
```

## 错误处理

为三层分析框架模式添加特定的错误处理：

```jsx
const handleAnalysisError = (error, mode) => {
  if (mode === 'three-layer') {
    if (error.message.includes('GROQ_API_KEY')) {
      alert('请先配置Groq API密钥！\n\n在.env文件中添加：\nGROQ_API_KEY=your_groq_api_key_here');
    } else {
      alert(`三层分析框架模式执行失败：${error.message}`);
    }
  } else {
    alert(`分析失败：${error.message}`);
  }
};
```

## 测试步骤

1. **配置API密钥**
   - 在 `.env` 文件中配置 `GROQ_API_KEY`
   - 重启服务器

2. **测试三个模式**
   - 上传同一个文档
   - 分别选择三个模式进行分析
   - 对比结果差异

3. **验证功能**
   - 检查三层分析框架模式是否正确调用Groq API
   - 验证属性唯一性是否提升
   - 确认ERWX闭环是否完整

## 总结

通过添加第三个"三层分析框架"模式，用户可以：

1. **直观对比**：在同一界面中选择不同模式，直观感受质量差异
2. **灵活选择**：根据项目需求选择最合适的模式
3. **成本优化**：使用Groq API降低成本，同时获得高质量结果
4. **质量提升**：三层分析框架确保FP边界清晰、属性唯一、ERWX完整

建议您先在本地测试三个模式的效果，然后根据实际需求决定是否在生产环境中启用对比功能。
