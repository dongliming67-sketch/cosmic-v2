# Cosmic拆分功能修改说明

## 修改日期
2024年12月17日（第四次更新）

## 本次修改内容

### 问题：触发类型判断不准确
**问题描述**：
- "搭建流处理集群" 被判断为用户触发，但可能是系统自动扩容
- "加工作业点级数据" 被判断为用户触发，但可能是定时批量加工
- 触发类型判断仅凭功能名称，没有考虑业务上下文

**根本原因分析**：
1. `intelligentTriggerAnalysis`函数的关键词列表不够完整
2. "加工"、"搭建"等词没有在任何关键词列表中
3. 系统提示词中对触发类型判断的说明不够清晰

**解决方案**：

### 1. 扩展触发类型关键词列表
```javascript
// 定时触发关键词（扩展后）
const timerKeywords = [
  '定时', '周期', '自动', '每日', '每周', '每月', '定期', 
  '巡检', '同步', '清理', '归档', '备份', '恢复',
  '统计汇总', '日报', '周报', '月报', '年报',
  '数据迁移', '批量处理', '批量加工', '批量同步',
  '自动生成', '自动更新', '自动清理', '自动归档',
  '定时检查', '定时扫描', '定时推送', '定时通知',
  '夜间处理', '凌晨执行', '后台处理', '后台任务'
];

// 接口触发关键词（扩展后）
const interfaceKeywords = [
  '接收推送', '接收数据', '接收消息', '接收通知', '接收告警', '接收请求',
  '回调', 'Webhook', 'webhook', 'callback',
  '消息队列', '事件监听', '事件处理', '事件响应',
  '外部接口', '第三方', '对接', '集成',
  '数据推送', '数据接收', '数据对接',
  '系统对接', '平台对接', '服务调用'
];

// 用户触发关键词（扩展后，包含"搭建"、"加工"等）
const userKeywords = [
  // 查询类
  '查询', '搜索', '筛选', '过滤', '检索', '浏览', '查看', '详情', '列表',
  // 增删改类
  '创建', '新增', '添加', '删除', '移除', '修改', '编辑', '更新', '保存',
  // 导入导出类
  '导出', '导入', '上传', '下载', '打印',
  // 审批流程类
  '审批', '审核', '提交', '撤销', '驳回', '通过', '拒绝',
  // 状态操作类
  '启用', '禁用', '激活', '停用', '暂停', '恢复', '取消', '确认',
  // 配置管理类
  '配置', '设置', '调整', '分配', '指派',
  // 发布类
  '发布', '上线', '下线', '部署',
  // 用户操作类
  '登录', '注册', '注销', '退出',
  // 其他用户操作（新增）
  '验证', '校验', '测试', '执行', '运行', '启动', '停止',
  '搭建', '构建', '生成', '加工', '处理', '计算', '分析'
];
```

### 2. 加强系统提示词中的触发类型说明
- 强调"根据文档上下文判断，而不是仅凭功能名称"
- 明确说明"即使功能名称中包含'执行'、'处理'、'加工'等词，只要是用户在界面上手动触发的，都属于用户触发"
- 添加更多典型场景示例

## 触发类型判断逻辑

### 判断优先级
1. **定时触发**（优先级最高）：包含"定时"、"周期"、"自动"、"每日"等关键词
2. **接口触发**（优先级次高）：包含"接收推送"、"回调"、"Webhook"等关键词
3. **用户触发**（默认）：包含"查询"、"创建"、"搭建"、"加工"等关键词，或无法判断时默认

### 判断示例
| 功能过程 | 判断结果 | 原因 |
|---------|---------|------|
| 搭建流处理集群 | 用户触发 | "搭建"是用户在界面上手动操作 |
| 加工作业点级数据 | 用户触发 | "加工"是用户手动触发的数据处理 |
| 查询作业点数据 | 用户触发 | "查询"是典型的用户操作 |
| 定时同步设备数据 | 时钟触发 | 包含"定时"关键词 |
| 每日生成统计报表 | 时钟触发 | 包含"每日"关键词 |
| 接收外部告警推送 | 接口触发 | 包含"接收推送"关键词 |

## 重要说明

**触发类型的最终判断应该由AI根据文档上下文来决定**，代码中的`intelligentTriggerAnalysis`函数只是作为备用的智能推断。

如果AI生成时已经正确标注了触发类型（如"时钟触发"、"接口触发"），代码会优先使用AI的判断结果。

## 测试建议
1. 重新启动服务器：`node server/index.js`
2. 上传测试文档进行Cosmic拆分
3. 检查功能用户和触发事件是否正确：
   - 用户界面操作 → 用户触发 + 用户请求
   - 定时/周期任务 → 时钟触发 + 定时任务
   - 外部接口/事件 → 接口触发 + 接口调用
