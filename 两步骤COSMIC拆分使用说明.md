# 两步骤COSMIC拆分模块使用说明

## 功能概述

两步骤COSMIC拆分模块是专为运营商网络网优&网管项目设计的功能拆分工具，严格按照COSMIC方法论进行需求分析和功能拆分。

### 核心特点

1. **分步骤处理**：将复杂的COSMIC拆分过程分为两个清晰的步骤
2. **可编辑确认**：在第一步完成后，用户可以编辑、修改功能过程列表
3. **专业提示词**：基于丰富的运营商业务经验设计的专业提示词
4. **符合规范**：严格遵循COSMIC方法论的规则和要求

## 使用流程

### 第一步：功能过程识别

1. **上传需求文档**
   - 支持格式：.docx、.txt、.md
   - 文档应包含完整的需求描述

2. **选择拆分模式**
   - 点击顶部工具栏的"两步骤拆分"按钮
   - 系统会切换到两步骤COSMIC拆分模式

3. **开始功能过程识别**
   - 点击"开始智能拆分"按钮
   - AI将自动分析需求文档并提取功能过程

4. **功能过程识别内容包括**
   - 功能模块名称
   - 功能用户（发起者和接收者）
   - 触发事件（用户触发、时钟触发、接口调用触发）
   - 功能过程（动词+名词形式）
   - 功能过程子过程详细描述

### 第二步：COSMIC拆分

1. **查看和编辑功能过程列表**
   - 功能过程识别完成后，会自动弹出编辑器
   - 在编辑器中可以：
     - ✅ 检查识别结果是否准确
     - ✏️ 修改功能过程描述
     - ➕ 添加遗漏的功能过程
     - ❌ 删除不需要的功能过程

2. **开始COSMIC拆分**
   - 确认功能过程列表无误后
   - 点击"开始COSMIC拆分"按钮
   - AI将按照COSMIC规则进行拆分

3. **COSMIC拆分结果包括**
   - 功能用户
   - 触发事件
   - 功能过程
   - 子过程描述
   - 数据移动类型（E/R/W/X）
   - 数据组
   - 数据属性

## 输出格式

### 第一步输出格式（功能过程列表）

```markdown
#功能模块名称
##功能用户
发起者：xxx 接收者：xxx
##触发事件
用户触发/时钟触发/接口调用触发
##功能过程
查询xxx/新增xxx/修改xxx/删除xxx
##功能过程子过程详细描述
具体的业务步骤描述
```

### 第二步输出格式（COSMIC表格）

| 功能用户 | 触发事件 | 功能过程 | 子过程描述 | 数据移动类型 | 数据组 | 数据属性 |
|---------|---------|---------|-----------|------------|--------|---------|
| 发起者：用户<br>接收者：用户 | 用户触发 | 查询保障项目信息 | 触发保障项目查询请求 | E | 保障项目查询请求 | 项目ID、查询条件、用户ID |
| 发起者：用户<br>接收者：用户 | 用户触发 | 查询保障项目信息 | 读取保障项目数据表 | R | 保障项目数据表 | 项目ID、项目名称、项目状态、创建时间 |
| 发起者：用户<br>接收者：用户 | 用户触发 | 查询保障项目信息 | 呈现保障项目查询结果 | X | 保障项目查询结果 | 项目信息列表、总条数、查询时间 |

## 核心规则说明

### 功能过程生成规则

1. **触发事件分类**
   - 用户触发：页面按钮操作
   - 时钟触发：定时任务、自动流转
   - 接口调用触发：作为被调用方的接口

2. **功能过程命名**
   - 格式：动词 + 名词
   - 示例：查询xxx指标、新增xxx规则、修改xxx配置、删除xxx数据

3. **功能用户对应关系**
   - 用户触发：发起者=用户，接收者=用户
   - 时钟触发：发起者=定时触发器，接收者=网优平台
   - 接口触发：发起者=其他平台，接收者=网优平台

### COSMIC拆分规则

1. **数据移动类型（ERWX）**
   - **E (Entry)**：外部数据进入系统
   - **R (Read)**：从持久存储读取数据
   - **W (Write)**：写入持久存储
   - **X (eXit)**：数据输出到外部

2. **子过程顺序**
   - 必须遵循：E（1个）→ R（1-2个）→ W（1-2个）→ X（1个）
   - 每个功能过程至少有1个E和1个X

3. **数据组命名**
   - E对应：xxx请求/xxx定时任务
   - R对应：xxx表/xxx文件
   - W对应：xxx表/xxx文件
   - X对应：xxx查询结果/xxx操作结果

4. **数据属性要求**
   - 至少3个字段
   - 必须包含唯一标识（ID、时间）
   - 使用中文顿号"、"分隔
   - 避免重复

## 注意事项

### ⚠️ 重要提示

1. **需求文档质量**
   - 需求文档应描述清晰、完整
   - 包含功能说明、字段定义、业务流程

2. **功能过程确认**
   - 第一步完成后务必仔细检查
   - 确保所有功能都已识别
   - 删除非功能性内容

3. **编辑器使用**
   - 保持Markdown格式
   - 不要删除## 标记
   - 每个功能过程应包含完整的4个部分

4. **拆分质量**
   - 确保ERWX逻辑完整
   - 避免数据组和数据属性重复
   - 检查触发事件分类是否正确

## 适用场景

### ✅ 适合使用两步骤模式的场景

- 需求文档结构清晰，功能描述完整
- 需要人工审核和调整功能过程
- 对拆分结果准确性要求高
- 熟悉COSMIC方法论的用户

### 🔄 其他拆分模式对比

| 模式 | 特点 | 适用场景 |
|-----|------|---------|
| **质量优先** | 智能识别，质量优先 | 一般需求文档 |
| **数量优先** | 尽可能多拆分 | 需要达到目标数量 |
| **三层分析框架** | 深度分析，属性唯一 | 复杂系统架构 |
| **两步骤拆分** | 分步确认，可编辑 | 需要人工审核 |

## 常见问题

### Q1: 第一步识别的功能过程不准确怎么办？
**A:** 在功能过程列表编辑器中直接修改即可。保持Markdown格式，按照模板添加或删除功能过程。

### Q2: 如何判断触发事件类型？
**A:** 
- 用户在界面点击按钮 → 用户触发
- 系统定时自动执行 → 时钟触发
- 其他系统调用接口 → 接口调用触发

### Q3: COSMIC拆分结果不满意可以重新拆吗？
**A:** 可以。回到编辑器修改功能过程列表，然后重新点击"开始COSMIC拆分"。

### Q4: 数据属性应该写中文还是英文？
**A:** 必须使用中文。如果需求文档是英文字段名，需要翻译成中文业务字段名。

### Q5: 一个功能过程最多可以拆分多少个子过程？
**A:** 建议每个功能过程拆分为4-6个子过程（1E + 1-2R + 1-2W + 1X）。

## 技术说明

### API接口

#### 第一步：功能过程识别
```
POST /api/two-step/extract-functions
Request: { documentContent: string }
Response: { success: boolean, functionProcessList: string }
```

#### 第二步：COSMIC拆分
```
POST /api/two-step/cosmic-split
Request: { functionProcessList: string }
Response: { 
  success: boolean, 
  cosmicResult: string,
  tableData: Array<CosmicRow>
}
```

### 提示词文件

- **服务端**: `server/two-step-cosmic-prompts.js`
- **STEP1_FUNCTION_EXTRACTION_PROMPT**: 功能过程识别提示词
- **STEP2_COSMIC_SPLIT_PROMPT**: COSMIC拆分提示词

## 更新日志

### v1.0.0 (2026-01-05)
- ✨ 新增两步骤COSMIC拆分模式
- ✨ 添加功能过程列表编辑器
- ✨ 支持Markdown格式的功能过程列表
- ✨ 集成专业的运营商网优业务提示词
- 🎨 优化UI界面和交互体验

## 开发者信息

如需修改提示词或调整拆分规则，请编辑以下文件：
- `server/two-step-cosmic-prompts.js` - 提示词模板
- `server/index.js` - API端点实现
- `client/src/App.jsx` - 前端UI和交互逻辑

---

**提示**: 使用过程中如有任何问题，请查看控制台日志获取详细信息。
